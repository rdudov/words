# Project Goal
Разработать Telegram-бота для изучения иностранных слов с использованием адаптивного алгоритма запоминания, который подстраивается под уровень знаний пользователя, усложняет задания и мотивирует к регулярной практике через уведомления и статистику прогресса.

# Task Description
Система представляет собой телеграм-бот для изучения иностранных слов с использованием адаптивного алгоритма запоминания. Бот постепенно усложняет проверку знаний: от выбора варианта ответа до самостоятельного ввода перевода. Слова, которые пользователь знает хорошо, показываются реже и постепенно исключаются из активной практики. Проверка проводится в обоих направлениях (родной язык → иностранный и наоборот).

# Actors
- Пользователь (изучающий язык)
- Бот (система обучения)
- LLM (языковая модель для получения переводов, примеров и валидации ответов)

# Use Cases

## UC1 — Регистрация и выбор языка обучения
**Actor:** Пользователь
**Goal:** Настроить профиль для изучения языка

**Scenario:**
1. Пользователь запускает бот (/start)
2. Бот запрашивает родной язык пользователя
3. Бот запрашивает иностранный язык для изучения
4. Бот запрашивает текущий уровень владения языком (A1, A2, B1, B2, C1, C2)
5. Бот сохраняет настройки профиля
6. Бот формирует начальный список слов для изучения на основе уровня

## UC2 — Смена языка или добавление нового
**Actor:** Пользователь
**Goal:** Изучать несколько языков или изменить язык обучения

**Scenario:**
1. Пользователь выбирает команду смены/добавления языка
2. Бот показывает текущие языки (если есть)
3. Пользователь выбирает добавление нового или переключение на существующий
4. Бот запрашивает язык и уровень (для нового)
5. Бот сохраняет изменения и формирует словарь для нового языка

## UC3 — Автоматическое формирование списка слов
**Actor:** Бот
**Goal:** Подобрать слова для изучения по уровню пользователя

**Scenario:**
1. Бот определяет уровень пользователя
2. Бот выбирает наиболее частотные слова для данного уровня
3. Бот добавляет слова в персональный словарь пользователя
4. Бот отмечает статус каждого слова как "новое"

## UC4 — Ручное добавление слова пользователем
**Actor:** Пользователь
**Goal:** Добавить конкретное слово в свой словарь

**Scenario:**
1. Пользователь вводит слово (на родном или иностранном языке)
2. Бот запрашивает перевод у LLM (проверяет кеш перед запросом)
3. Бот показывает все значения слова с примерами использования
4. Бот показывает формы слова (множественное число, склонения, спряжения)
5. Пользователь выбирает нужное значение или подтверждает добавление всех
6. Бот добавляет слово в персональный словарь пользователя
7. Результат запроса к LLM кешируется для будущего использования

## UC5 — Запуск урока пользователем
**Actor:** Пользователь
**Goal:** Начать практику изучения слов

**Scenario:**
1. Пользователь инициирует урок (команда/кнопка)
2. Бот выбирает слова для проверки на основе адаптивного алгоритма (30 слов по умолчанию)
3. Бот приоритизирует слова для самостоятельного ввода; если их недостаточно, добавляет слова с выбором варианта
4. Бот начинает последовательность проверок (см. UC7, UC8)
5. По завершении бот показывает статистику урока (количество правильных/неправильных ответов, новые слова)

## UC6 — Автоматическое напоминание о практике
**Actor:** Бот
**Goal:** Мотивировать пользователя к регулярной практике

**Scenario:**
1. Бот отслеживает время последнего урока пользователя
2. Если прошло 6 часов (настраиваемое значение) без активности в дневное время (7:00-23:00 МСК)
3. Бот отправляет пуш-уведомление с напоминанием
4. Пользователь может начать урок или отложить

## UC7 — Проверка знания слова (выбор варианта)
**Actor:** Бот
**Goal:** Проверить знание слова на начальном этапе

**Scenario:**
1. Бот показывает слово (на родном или иностранном языке)
2. Бот предлагает несколько вариантов перевода (3-5 вариантов)
3. Пользователь выбирает правильный вариант
4. Бот оценивает ответ (правильно/неправильно)
5. Бот показывает правильный ответ и обновляет статистику слова
6. При правильном ответе бот повышает уровень знания слова

## UC8 — Проверка знания слова (самостоятельный ввод)
**Actor:** Бот
**Goal:** Проверить глубокое знание слова

**Scenario:**
1. Бот показывает слово (на родном или иностранном языке)
2. Бот просит ввести перевод самостоятельно
3. Пользователь вводит ответ
4. Бот проверяет ответ с учетом возможных форм и опечаток
5. Бот показывает результат и правильный ответ (если ошибка)
6. Бот обновляет статистику слова

**Alternative Scenario (опечатка):**
- Если ответ близок к правильному (1-2 опечатки)
- Бот указывает на опечатку и предлагает исправить
- Или засчитывает как частично правильный ответ

**Alternative Scenario (несколько значений):**
- Если у слова несколько значений
- Бот принимает любое корректное значение
- Бот показывает все возможные варианты перевода

## UC9 — Обработка ошибок и опечаток
**Actor:** Бот
**Goal:** Корректно обрабатывать неточности в ответах пользователя

**Scenario (многоуровневая проверка):**
1. Бот получает ответ пользователя
2. **Уровень 1: Точное совпадение**
   - Если ответ полностью совпадает с правильным
   - Бот засчитывает ответ как правильный
3. **Уровень 2: Проверка опечаток**
   - Бот применяет алгоритм нечеткого сравнения (Levenshtein distance)
   - Если расстояние мало (1-2 символа) — считать опечаткой
   - Бот указывает на опечатку и показывает правильный вариант
   - Бот учитывает опечатку в статистике с меньшим штрафом
4. **Уровень 3: Валидация через LLM**
   - Если ответ не прошёл уровни 1 и 2
   - Бот отправляет запрос к LLM: вопрос, ожидаемый ответ и ответ пользователя
   - LLM оценивает корректность ответа (синонимы, другие формы слова, близкие значения)
   - LLM возвращает: результат (принять/отклонить) и комментарий для пользователя
   - Бот показывает комментарий вида: "Ответ засчитывается, но ожидалось [правильный ответ], потому что [объяснение]"
   - Или: "Ответ неверный, потому что [объяснение]. Правильный ответ: [правильный ответ]"

## UC10 — Адаптивный показ слов
**Actor:** Бот
**Goal:** Оптимизировать процесс запоминания

**Scenario:**
1. Бот отслеживает статистику по каждому слову (правильные/неправильные ответы)
2. Бот отслеживает статистику отдельно для каждого направления перевода
3. Слова с плохой статистикой показываются чаще
4. Слова с хорошей статистикой показываются реже
5. Слова, выученные без ошибок 30 раз подряд (настраиваемое значение), исключаются из активной практики
6. Слова переходят из режима "выбор варианта" в "самостоятельный ввод" после нескольких правильных ответов

## UC11 — Просмотр прогресса
**Actor:** Пользователь
**Goal:** Отслеживать свой прогресс в изучении

**Scenario:**
1. Пользователь запрашивает статистику
2. Бот показывает: общее количество слов, выученные слова, слова в процессе, новые слова
3. Бот показывает статистику по урокам (дни подряд, всего уроков)
4. Бот показывает прогресс по текущему языку

## UC12 — Проверка в обоих направлениях
**Actor:** Бот
**Goal:** Проверять знание перевода в обе стороны

**Scenario:**
1. При выборе слова для проверки бот случайным образом определяет направление
2. Направление 1: родной язык → иностранный
3. Направление 2: иностранный язык → родной
4. Бот отслеживает статистику по каждому направлению отдельно

# Non-Functional Requirements

## Performance
- Время отклика на команды пользователя: не более 2 секунд
- Обработка запроса к LLM:
  - Переводы и примеры: не более 5 секунд (с таймаутом)
  - Валидация ответа: не более 3 секунд (с таймаутом)
  - Кешированные результаты: мгновенно
- Система должна поддерживать минимум 100 одновременных пользователей

## Reliability & Availability
- Работа бота 24/7 с доступностью не менее 99%
- Graceful degradation при недоступности внешних API (работа с локальным кешем)
- Автоматическое восстановление после сбоев

## Error Handling
- При недоступности LLM API: использование локального кеша, если результат кеширован ранее
- При таймауте LLM: повторная попытка (до 3 раз) с экспоненциальной задержкой
- При превышении лимитов LLM:
  - Переключение на резервную модель (если настроена)
  - Временная приостановка добавления новых слов
  - Уведомление пользователя о технических проблемах
- При ошибке валидации ответа через LLM:
  - Fallback на базовое сравнение (принять только точные совпадения)
  - Логирование ошибки для дальнейшего анализа
- Все критические ошибки должны логироваться для последующего анализа

## Localization
- Интерфейс бота полностью на родном языке пользователя
- Поддержка минимум 3 языков интерфейса на старте: русский, английский, испанский
- Возможность добавления новых языков интерфейса через конфигурационные файлы

## Logging & Monitoring
- Логирование всех действий пользователя (команды, ответы, ошибки)
- Логирование обращений к внешним API и их результатов
- Мониторинг ключевых метрик: количество активных пользователей, проведённых уроков, ошибок API
- Уровни логирования: DEBUG, INFO, WARNING, ERROR, CRITICAL
- Хранение логов минимум 30 дней

## Security
- Безопасное хранение API ключей и токенов через переменные окружения
- Защита данных пользователя (никакой передачи третьим лицам)
- Регулярное резервное копирование базы данных

## Scalability
- Возможность горизонтального масштабирования при росте числа пользователей
- Использование очередей для отложенных задач (уведомления, обновление статистики)

# Data Model

## Database Structure

### Таблица: users
- `user_id` (primary key) — Telegram user ID
- `native_language` — родной язык пользователя
- `interface_language` — язык интерфейса бота
- `created_at` — дата регистрации
- `last_active_at` — время последней активности
- `notification_enabled` — включены ли уведомления

### Таблица: language_profiles
- `profile_id` (primary key)
- `user_id` (foreign key → users)
- `target_language` — изучаемый язык
- `level` — уровень (A1, A2, B1, B2, C1, C2)
- `is_active` — активный ли профиль
- `created_at` — дата создания профиля

### Таблица: words
- `word_id` (primary key)
- `word` — слово на иностранном языке
- `language` — язык слова
- `level` — рекомендуемый уровень CEFR
- `translations` (JSON) — переводы на разные языки
- `examples` (JSON) — примеры использования
- `word_forms` (JSON) — формы слова (множественное число, склонения)

### Таблица: user_words
- `user_word_id` (primary key)
- `profile_id` (foreign key → language_profiles)
- `word_id` (foreign key → words)
- `status` — статус: new, learning, reviewing, mastered
- `added_at` — дата добавления в словарь пользователя
- `last_reviewed_at` — дата последней проверки
- `next_review_at` — дата следующей проверки (для spaced repetition)

### Таблица: word_statistics
- `stat_id` (primary key)
- `user_word_id` (foreign key → user_words)
- `direction` — направление перевода: native_to_foreign, foreign_to_native
- `test_type` — тип проверки: multiple_choice, input
- `correct_count` — количество правильных ответов подряд
- `total_attempts` — всего попыток
- `total_correct` — всего правильных ответов
- `total_errors` — всего ошибок

### Таблица: lessons
- `lesson_id` (primary key)
- `profile_id` (foreign key → language_profiles)
- `started_at` — время начала урока
- `completed_at` — время завершения урока
- `words_count` — количество слов в уроке
- `correct_answers` — количество правильных ответов
- `incorrect_answers` — количество неправильных ответов

### Таблица: lesson_attempts
- `attempt_id` (primary key)
- `lesson_id` (foreign key → lessons)
- `user_word_id` (foreign key → user_words)
- `direction` — направление перевода
- `test_type` — тип проверки
- `user_answer` — ответ пользователя
- `correct_answer` — правильный ответ
- `is_correct` — правильность ответа
- `attempted_at` — время попытки

### Таблица: cached_translations (для оптимизации и экономии запросов к LLM)
- `cache_id` (primary key)
- `word` — исходное слово
- `source_language` — язык источника
- `target_language` — целевой язык
- `translation_data` (JSON) — кешированный результат от LLM (переводы, примеры, формы слова)
- `cached_at` — время кеширования
- `expires_at` — время истечения кеша (NULL = не истекает)

### Таблица: cached_validations (для кеширования проверок ответов через LLM)
- `validation_id` (primary key)
- `word_id` (foreign key → words)
- `direction` — направление перевода (native_to_foreign, foreign_to_native)
- `expected_answer` — ожидаемый правильный ответ
- `user_answer` — ответ пользователя
- `is_correct` — результат валидации (true/false)
- `llm_comment` — комментарий от LLM для пользователя
- `cached_at` — время кеширования
- Уникальный индекс: (word_id, direction, expected_answer, user_answer)

# Inputs
- Команды пользователя в Telegram
- Текстовый ввод (слова, переводы, ответы на вопросы)
- Выбор вариантов через inline-кнопки
- Настройки профиля (язык, уровень)
- Слова для добавления (родной или иностранный язык)

# Outputs
- Сообщения в Telegram чат
- Inline-клавиатуры с вариантами ответов
- Пуш-уведомления о необходимости практики
- Статистика и прогресс обучения
- Переводы слов с примерами и формами
- Результаты проверки (правильно/неправильно)

# Constraints
- Пуш-уведомления отправляются только в дневное время (7:00-23:00 МСК)
- Интервал пуш-уведомлений: 6 часов без активности (настраивается через переменную окружения)
- Количество слов в одном уроке: 30 (настраивается через переменную окружения)
- Приоритет самостоятельному вводу; если слов недостаточно, добавляются слова с выбором варианта
- Слово считается выученным после 30 правильных ответов подряд (настраивается через переменную окружения)
- Алгоритм адаптивного показа должен учитывать как частоту показа, так и время последней проверки
- Проверка опечаток должна допускать расстояние не более 2 символов
- Слова должны подбираться по частотности для конкретного уровня языка
- Поддержка множественных форм слова (склонения, спряжения, множественное число)
- Проверка в обоих направлениях (родной ↔ иностранный)
- Статистика ведётся отдельно для каждого направления перевода
- Интерфейс бота полностью на родном языке пользователя
- Контекст использования слова (формальный/неформальный) не учитывается
- Аудио произношение слов не поддерживается

# Dependencies
- Telegram Bot API (python-telegram-bot или aiogram)
- База данных для хранения пользователей, слов и статистики (SQLite или PostgreSQL)
- **LLM API (дешёвая модель)** для:
  - Получения переводов слов
  - Генерации примеров использования
  - Валидации ответов пользователя (синонимы, альтернативные формы)
  - Возможные варианты: OpenAI gpt-4o-mini
- Библиотека для нечеткого сравнения строк (python-Levenshtein, difflib)
- Планировщик задач для пуш-уведомлений (APScheduler, Celery)
- Словари частотных слов по уровням CEFR (A1-C2):
  - Приоритет: готовые CEFR списки для русского, английского, испанского
  - Альтернатива: генерация через LLM при отсутствии готовых списков

# Relation to Existing Project
- Это новый проект, репозиторий пустой
- Требуется разработка с нуля всех компонентов
- Необходимо определить архитектуру и структуру проекта

# Environment
- Python 3.10+
- Telegram Bot (работа 24/7 для отправки уведомлений)
- База данных (SQLite или PostgreSQL)
- **Хостинг:** Локальный сервер (по аналогии с `/opt/projects/companions/`)
  - Использование виртуального окружения (venv)
  - Структурированная организация кода
  - Интеграция с существующей инфраструктурой сервера
- Доступ к LLM API (дешёвая модель для переводов и валидации)
- Переменные окружения для настройки:
  - `TELEGRAM_BOT_TOKEN` — токен Telegram бота
  - `LLM_API_KEY` — ключ API для LLM
  - `LLM_MODEL` — модель LLM (по умолчанию: gpt-4o-mini)
  - `DATABASE_URL` — путь к базе данных
  - `WORDS_PER_LESSON` (по умолчанию: 30)
  - `MASTERED_THRESHOLD` (по умолчанию: 30 правильных ответов)
  - `NOTIFICATION_INTERVAL_HOURS` (по умолчанию: 6)
  - `NOTIFICATION_TIME_START` (по умолчанию: 07:00 МСК)
  - `NOTIFICATION_TIME_END` (по умолчанию: 23:00 МСК)
  - `TIMEZONE` (по умолчанию: Europe/Moscow)

# Notes

## ✅ Принятые технические решения

### 1. Сервис для получения переводов и примеров использования

**Решение:** Использовать **дешёвую LLM** для всех операций с переводами:
- Получение переводов слов
- Генерация примеров использования
- Валидация ответов пользователя (синонимы, альтернативные формы)

**Преимущества:**
- ✅ Проще в реализации (единый интерфейс)
- ✅ Гибкость для любого языка
- ✅ Контекстные примеры
- ✅ Интеллектуальная валидация ответов

**Рекомендуемые модели:**
- OpenAI gpt-4o-mini (дешёвая, быстрая)

**Кеширование:** Все результаты LLM кешируются в таблице `cached_translations` для экономии запросов.

### 2. Начальный набор языков

**Решение:** Поддержка **3 языков** на старте:
- Русский
- Английский
- Испанский

Возможность добавления других языков в будущем через конфигурационные файлы.

### 3. Монетизация

**Решение:** Проект пока **полностью бесплатный**, монетизация не рассматривается.

### 4. Хостинг

**Решение:** Размещение на локальном сервере по аналогии с `/opt/projects/companions/`
- Использование виртуального окружения (venv)
- Структурированная организация кода
- Интеграция с существующей инфраструктурой

### 5. Источник частотных списков

**Решение:** Приоритет — готовые **CEFR списки** для русского, английского, испанского.
- Если не удастся найти качественные списки — генерировать через LLM
- Возможна комбинация: базовый набор из CEFR + дополнение через LLM

### 6. Логика проверки ответов (самостоятельный ввод)

**Решение:** Трёхуровневая система проверки:

1. **Точное совпадение** — ответ засчитывается сразу
2. **Проверка опечаток** (Levenshtein distance ≤ 2) — засчитывается с замечанием
3. **Валидация через LLM** — для всех остальных случаев:
   - Отправляем LLM: вопрос, ожидаемый ответ, ответ пользователя
   - LLM оценивает корректность (синонимы, другие формы, близкие значения)
   - LLM возвращает: результат + комментарий для пользователя
   - Примеры комментариев:
     - "Ответ засчитывается, но ожидалось 'house', потому что 'home' — более общее понятие"
     - "Ответ неверный, потому что 'buy' означает 'покупать', а не 'продавать'. Правильный ответ: 'sell'"

## Дополнительные заметки

### Поведение при смене уровня пользователя

**Сценарий:**
1. Пользователь может изменить уровень языка в настройках профиля
2. При смене уровня:
   - Статистика по существующим словам сохраняется
   - Бот предлагает добавить новые слова соответствующего уровня
   - Выученные слова остаются выученными (не сбрасываются)
   - Адаптивный алгоритм продолжает работать с текущей статистикой

**Альтернативный вариант (настраиваемый):**
- Пользователь может выбрать "начать заново" — тогда статистика сбрасывается для всех слов

# Acceptance Criteria (Критерии приёмки)

## MVP (Minimum Viable Product)

### Обязательные функции для запуска:
1. **Регистрация и профиль**
   - Пользователь может зарегистрироваться через /start
   - Выбор родного языка, иностранного языка и уровня работает корректно
   - Профиль сохраняется в базе данных

2. **Словарь**
   - Автоматическое формирование начального списка слов (минимум 50 слов) по уровню
   - Возможность добавления слова вручную через бота
   - Получение переводов и примеров от внешнего API или локального словаря

3. **Уроки**
   - Запуск урока с выбором 30 слов на основе адаптивного алгоритма
   - Проверка знаний в двух режимах: выбор варианта и самостоятельный ввод
   - Проверка в обоих направлениях (родной ↔ иностранный)
   - Корректное отслеживание правильных/неправильных ответов
   - Завершение урока с показом статистики

4. **Адаптивный алгоритм**
   - Слова с плохой статистикой показываются чаще
   - Слова с хорошей статистикой показываются реже
   - Переход от режима "выбор варианта" к "самостоятельный ввод" после нескольких правильных ответов
   - Исключение выученных слов (30 правильных ответов подряд) из активной практики

5. **Обработка опечаток**
   - Нечёткое сравнение ответов (Levenshtein distance ≤ 2)
   - Индикация опечаток пользователю

6. **Статистика**
   - Просмотр общей статистики: выученные слова, слова в процессе, новые слова
   - Статистика по урокам: количество уроков, дни подряд

7. **Напоминания**
   - Автоматические пуш-уведомления о необходимости практики
   - Настройка интервала через переменные окружения
   - Отправка только в дневное время (07:00–23:00 МСК)

8. **Надёжность**
   - Graceful обработка ошибок API
   - Логирование всех критических событий
   - Сохранение прогресса при сбоях

### Критерии качества:
- Время отклика на команды: не более 2 секунд (без учёта внешних API)
- Корректность переводов: минимум 95% точность (проверка на тестовой выборке)
- Работа без критических ошибок в течение 24 часов

### Критерии тестирования:
- Unit-тесты для ключевых функций (адаптивный алгоритм, обработка опечаток)
- Integration-тесты для взаимодействия с Telegram API и внешними сервисами
- End-to-end тест полного цикла: регистрация → добавление слов → урок → статистика

## Post-MVP (будущие версии)
- Поддержка множества языков для одного пользователя
- Геймификация (достижения, стрики, рейтинги)
- Расширенная статистика с графиками прогресса
- Темы и категории слов (бизнес, путешествия, повседневная жизнь)
- Экспорт/импорт словарей

# Risks & Limitations (Риски и ограничения)

## Технические риски
1. **Зависимость от LLM API**
   - Риск: LLM API может быть недоступен, превысить лимиты или снизить качество
   - Митигация: Локальное кеширование всех запросов, возможность переключения на другую модель, graceful fallback на базовые переводы

2. **Качество переводов от LLM**
   - Риск: LLM может генерировать неточные переводы или примеры
   - Митигация: Кеширование проверенных переводов, возможность пользователя сообщить об ошибке, постепенное накопление базы качественных переводов

3. **Стоимость использования LLM**
   - Риск: При росте числа пользователей затраты на LLM могут вырасти
   - Митигация: Агрессивное кеширование, использование дешёвых моделей (gpt-4o-mini), возможный переход на локальные модели в будущем

4. **Масштабируемость**
   - Риск: Рост числа пользователей может привести к проблемам с производительностью
   - Митигация: Использование очередей для уведомлений, оптимизация запросов к БД, горизонтальное масштабирование

4. **Ограниченная поддержка языков**
   - Риск: Для некоторых языков может не быть качественных частотных списков или словарей
   - Митигация: Начать с популярных языков (английский, испанский, немецкий, французский), постепенно добавлять остальные

## Бизнес-риски
1. **Удержание пользователей**
   - Риск: Пользователи могут потерять интерес к изучению языка
   - Митигация: Напоминания, геймификация (post-MVP), персонализированный подход

2. **Конкуренция**
   - Риск: Существуют аналогичные приложения (Duolingo, Anki, Memrise)
   - Митигация: Фокус на простоте использования через Telegram, адаптивный алгоритм, бесплатная модель

## Ограничения проекта
1. **Нет поддержки аудио произношения** — реализация в будущих версиях
2. **Нет учёта контекста (формальный/неформальный)** — упрощение для MVP
3. **Ограничение по количеству слов в уроке** — настраивается, но по умолчанию 30
4. **Проверка только текстовых переводов** — без картинок, видео, диалогов

# Questions for Clarification (Вопросы для уточнения)

Следующие вопросы требуют дополнительного уточнения с заказчиком/командой:

1. **Выбор основного API для переводов:** Google Translate, DeepL, Wiktionary или гибридный подход?

Лучше сделать перевод через LLM - это может быть чуть дороже и менее точно, но проще в реализации. Можно использовать дешёвую LLM.

2. **Начальный набор языков:** С каких языковых пар начать? (например, русский→английский, русский→испанский)

Русский, английский, испанский.

3. **Модель монетизации:** Полностью бесплатный продукт или планируется premium-подписка в будущем?

Пока не рассматриваем монетизацию.

4. **Хостинг:** Локальный сервер, VPS (DigitalOcean, AWS) или специализированная платформа для ботов?

Хостинг будет на этом сервере (по аналогии с /opt/projects/companions/)

5. **Источник частотных списков:** Использовать готовые CEFR списки или генерировать через LLM?

Попробуем CEFR. Если не получится, будем думать.

6. **Обработка синонимов:** Засчитывать ли синонимы как правильные ответы при самостоятельном вводе?

Давай уточним логику проверки ответа (самостоятельный ввод):
1) точное совпадение - вопросов нет, ответ засчитываем
2) опечатка - как уже описано в UC
3) не 1 и 2 - валидируем ответ через LLM: отправляем вопрос, ожидаемый правильный ответ и ответ пользователя. Получаем от LLM оценку корректности и комментарий для пользователя вида "ответ засчитывается, но ожидалось ... потому-что ..."